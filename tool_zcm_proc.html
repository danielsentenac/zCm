<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>zCm: zcm-proc</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="zcm-dark.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">zCm
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
   <div id="projectbrief">Lightweight messaging toolkit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('tool_zcm_proc.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">zcm-proc </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><code>zcm_proc</code> is a single unified process daemon.</p>
<h1><a class="anchor" id="tool_zcm_proc_impl"></a>
Implementation</h1>
<p>Primary implementation files:</p><ul>
<li>example executable entrypoint: <code>examples/proc/zcm_proc_main.c</code></li>
<li>high-level bootstrap helpers: <code>src/high-level/zcm_proc.c</code></li>
<li>runtime/config/data-worker logic: <code>src/high-level/zcm_proc_runtime.c</code></li>
</ul>
<p>Public runtime/config structures:</p><ul>
<li><code><a class="el" href="zcm__proc__runtime_8h.html" title="Runtime config parsing and bootstrap helpers for zcm_proc daemons.">include/zcm/zcm_proc_runtime.h</a></code></li>
</ul>
<p>Unified process executable: </p><div class="fragment"><div class="line">./build/examples/zcm_proc &lt;proc-config.cfg&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md14"></a>
Behavior</h2>
<ul>
<li>Every <code>zcm_proc</code> is an infinite daemon.</li>
<li>It always answers requests over direct ZeroMQ <code>REQ/REP</code> semantics.</li>
<li>Default command behavior is <code>PING -&gt; PONG</code>.</li>
<li>It periodically re-registers in broker so names recover after broker restart.<ul>
<li>tune interval with <code>ZCM_PROC_REANNOUNCE_MS</code> (default <code>1000</code>)</li>
</ul>
</li>
<li>Optional repeated <code>dataSocket</code> entries configure bytes <code>PUB/SUB/PUSH/PULL</code> roles.</li>
</ul>
<h2><a class="anchor" id="autotoc_md15"></a>
Config</h2>
<p>Validation schema:</p><ul>
<li><code>$ZCM_PROC_CONFIG_SCHEMA</code> or <code>config/schema/proc-config.xsd</code></li>
</ul>
<p>Required:</p><ul>
<li><code>&lt;process @name&gt;</code></li>
</ul>
<p>Optional:</p><ul>
<li>repeated <code>&lt;dataSocket .../&gt;</code> for <code>PUB/SUB/PUSH/PULL</code></li>
<li><code>&lt;control @timeoutMs&gt;</code></li>
<li><code>&lt;handlers&gt;</code></li>
</ul>
<p><code>dataSocket</code> attributes:</p><ul>
<li><code>type</code>: <code>PUB</code>, <code>SUB</code>, <code>PUSH</code>, or <code>PULL</code></li>
<li><code>PUB</code>/<code>PUSH</code> port is auto-allocated from the current domain range</li>
<li><code>payload</code>: optional <code>PUB</code>/<code>PUSH</code> payload (default <code>tick</code>)</li>
<li><code>intervalMs</code>: optional <code>PUB</code>/<code>PUSH</code> period (default <code>1000</code>)</li>
<li><code>targets</code>: comma-separated source names for <code>SUB</code>/<code>PULL</code> (multi-target)</li>
<li><code>target</code>: optional single-target compatibility alias for <code>SUB</code>/<code>PULL</code></li>
<li><code>topics</code>: optional <code>SUB</code>-only comma-separated topic prefixes (example: <code>topics="prefix1,prefix2"</code>). If omitted, <code>SUB</code> subscribes to all.</li>
</ul>
<p>Handlers:</p><ul>
<li>builtin command behavior is fixed: <code>PING -&gt; PONG</code> (default reply <code>OK</code>)</li>
<li><code>&lt;type name="..."&gt; &lt;arg kind="..."/&gt; ... &lt;/type&gt;</code></li>
<li><code>arg kind</code>: <code>text</code>, <code>double</code>, <code>float</code>, <code>int</code></li>
<li>TYPE payload order is strict.</li>
<li>TYPE handler reply is built in user code and sent as typed message <code>"&lt;REQ_TYPE&gt;_RPL"</code> with any payload fields your handler writes.</li>
<li>Malformed TYPE payload reply: <code>ERROR</code> with expected format.</li>
<li>each <code>SUB</code> target discovers publisher port with command <code>DATA_PORT_PUB</code> (fallback alias: <code>DATA_PORT</code>).</li>
<li>each <code>PULL</code> target discovers pusher port with command <code>DATA_PORT_PUSH</code>.</li>
<li>payload-byte introspection commands:<ul>
<li><code>DATA_PAYLOAD_BYTES_PUB</code></li>
<li><code>DATA_PAYLOAD_BYTES_SUB</code></li>
<li><code>DATA_PAYLOAD_BYTES_PUSH</code></li>
<li><code>DATA_PAYLOAD_BYTES_PULL</code></li>
</ul>
</li>
</ul>
<p>Process config at init (required):</p><ul>
<li>zcm_proc reads the XML file path passed on the command line.</li>
<li>XML is validated against:<ul>
<li><code>$ZCM_PROC_CONFIG_SCHEMA</code>, else <code>config/schema/proc-config.xsd</code></li>
</ul>
</li>
<li><code>&lt;process @name&gt;</code> is the process registration name.</li>
<li><code>zcm_proc</code> is always an infinite daemon (no runtime mode).</li>
<li><code>zcm_proc</code> re-announces its registration periodically so names are restored if broker restarts.<ul>
<li>interval can be tuned with <code>ZCM_PROC_REANNOUNCE_MS</code> (default <code>1000</code>)</li>
</ul>
</li>
<li>Optional repeated <code>&lt;dataSocket&gt;</code> configures bytes <code>PUB/SUB/PUSH/PULL</code>:<ul>
<li><code>type=PUB|SUB|PUSH|PULL</code></li>
<li><code>PUB</code>/<code>PUSH</code> auto-allocate a port from the current domain range and use optional <code>payload</code>, <code>intervalMs</code></li>
<li><code>SUB</code>/<code>PULL</code> use <code>targets=&lt;proc-a,proc-b,...&gt;</code> (or legacy <code>target=&lt;proc-name&gt;</code>)</li>
<li><code>SUB</code> can define <code>topics=&lt;prefix1,prefix2,...&gt;</code> for topic-prefix filtering (default is all topics)</li>
<li>each <code>SUB</code> target publisher port is discovered via <code>DATA_PORT_PUB</code> (fallback: <code>DATA_PORT</code>)</li>
<li>each <code>PULL</code> target pusher port is discovered via <code>DATA_PORT_PUSH</code></li>
</ul>
</li>
<li>Optional <code>&lt;handlers&gt;</code> adds request reply rules:<ul>
<li>builtin command behavior is fixed: <code>PING -&gt; PONG</code> (default reply <code>OK</code>)</li>
<li>repeated <code>&lt;type name=...&gt;&lt;arg kind=.../&gt;...&lt;/type&gt;</code> with ordered payload args</li>
<li>TYPE replies are built in handler code and sent as typed messages with name <code>&lt;REQ_TYPE&gt;_RPL</code></li>
<li>malformed TYPE requests are rejected with <code>ERROR</code> and expected TYPE format</li>
<li><code>zcm send</code> preserves the exact order of repeated payload flags</li>
<li>payload flags: <code>-t/-d/-f/-i/-c/-s/-l/-b/-a</code></li>
<li><code>-a</code> uses <code>kind:v1,v2,...</code> with <code>kind=char|short|int|float|double</code></li>
</ul>
</li>
<li>Examples: <code>data/basic.cfg</code>, <code>data/publisher.cfg</code>, <code>data/subscriber.cfg</code>, <code>data/pusher.cfg</code>, <code>data/puller.cfg</code>, <code>docs/config/zcmproc.cfg</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md16"></a>
Example</h2>
<div class="fragment"><div class="line">&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;UTF-8&quot;</span>?&gt;</div>
<div class="line">&lt;<span class="keywordtype">procConfig</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">process</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;basic&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">dataSocket</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;PUB&quot;</span> <span class="keyword">payload</span>=<span class="stringliteral">&quot;basic-pub&quot;</span> <span class="keyword">intervalMs</span>=<span class="stringliteral">&quot;1000&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">dataSocket</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;SUB&quot;</span> <span class="keyword">targets</span>=<span class="stringliteral">&quot;publisher&quot;</span> <span class="keyword">topics</span>=<span class="stringliteral">&quot;publisher&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">control</span> <span class="keyword">timeoutMs</span>=<span class="stringliteral">&quot;200&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">handlers</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">type</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;QUERY&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">arg</span> <span class="keyword">kind</span>=<span class="stringliteral">&quot;double&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">arg</span> <span class="keyword">kind</span>=<span class="stringliteral">&quot;double&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">arg</span> <span class="keyword">kind</span>=<span class="stringliteral">&quot;text&quot;</span>/&gt;</div>
<div class="line">        &lt;<span class="keywordtype">arg</span> <span class="keyword">kind</span>=<span class="stringliteral">&quot;double&quot;</span>/&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">type</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">handlers</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">process</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">procConfig</span>&gt;</div>
</div><!-- fragment --><p>Run: </p><div class="fragment"><div class="line">ZCMDOMAIN=myplace ZCMROOT=/path/to/zcmroot ./build/examples/zcm_proc data/basic.cfg</div>
<div class="line">ZCMDOMAIN=myplace ZCMROOT=/path/to/zcmroot ./build/tools/zcm ping basic</div>
<div class="line">./build/tools/zcm send basic -type QUERY -d 5 -d 7 -t action -d 0</div>
</div><!-- fragment --><p>PUSH/PULL quick run: </p><div class="fragment"><div class="line">ZCMDOMAIN=myplace ZCMROOT=/path/to/zcmroot ./build/examples/zcm_proc data/pusher.cfg</div>
<div class="line">ZCMDOMAIN=myplace ZCMROOT=/path/to/zcmroot ./build/examples/zcm_proc data/puller.cfg</div>
</div><!-- fragment --><p> Expected logs:</p><ul>
<li><code>pusher</code>: <code>[PUSH pusher] started: ...</code></li>
<li><code>puller</code>: <code>[PULL puller] connected ...</code> then <code>[PULL puller] received payload ...</code></li>
</ul>
<p>Additional generic config examples:</p><ul>
<li><code>data/publisher.cfg</code> (<code>publisher</code> with <code>PUB</code>)</li>
<li><code>data/subscriber.cfg</code> (<code>subscriber</code> with <code>SUB</code> to <code>basic</code>)</li>
<li><code>data/pusher.cfg</code> (<code>pusher</code> with <code>PUSH</code>)</li>
<li><code>data/puller.cfg</code> (<code>puller</code> with <code>PULL</code> to <code>pusher</code>) </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="md_docs_tools.html">Tools</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
